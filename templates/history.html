{% extends 'base.html' %}
{% block extra_head %}
<style>
  .history-title { color: #eaf2ff; text-shadow: 0 2px 10px rgba(37,99,235,0.25); }
  .history-list { display: grid; gap: 1rem; }
  @media (min-width: 768px) { .history-list { grid-template-columns: 1fr 1fr; } }
  .history-card {
    background: #0b1220;
    border: 1px solid rgba(56,189,248,0.35);
    border-radius: 0.75rem;
    padding: 1rem 1.25rem;
    box-shadow: 0 0 0 1px rgba(56,189,248,0.25) inset, 0 12px 28px rgba(0,0,0,0.45), 0 0 24px rgba(37,99,235,0.15);
  }
  .meta { color: #93c5fd; opacity: 0.85; font-size: 0.85rem; }
  .prediction-line { margin-top: 0.25rem; }
  .prediction-highlight {
    color: #eaf2ff;
    text-shadow: 0 0 10px rgba(56,189,248,0.35), 0 0 18px rgba(37,99,235,0.25);
    font-weight: 700;
  }
  .top-label { color: #c7d2fe; font-size: 0.9rem; }
  .chip {
    display: inline-block;
    margin-right: 0.4rem; margin-bottom: 0.3rem;
    padding: 0.25rem 0.5rem;
    border-radius: 9999px;
    background: rgba(37,99,235,0.15);
    border: 1px solid rgba(56,189,248,0.35);
    color: #e5edff;
    box-shadow: 0 0 14px rgba(37,99,235,0.18);
    font-size: 0.85rem;
  }
  .empty { color: #9ca3af; }
  .card-row { display:flex; align-items: baseline; justify-content: space-between; gap: .75rem; }
</style>
{% endblock %}
{% block content %}
<h2 class="text-2xl font-semibold mb-4 history-title">Your History</h2>
{% if history %}
  <div class="history-list">
    {% for item in history %}
      <div class="history-card">
        <div class="card-row">
          <div class="meta"><span class="timeago" data-time="{{ item.timestamp if item.timestamp else item['timestamp'] }}">{{ item.timestamp if item.timestamp else item['timestamp'] }}</span></div>
        </div>
        <div class="prediction-line">Prediction: <span class="prediction-highlight">{{ item.prediction if item.prediction else item['prediction'] }}</span></div>
        {% if item.top %}
        <div class="top-label mt-1">Top matches:</div>
        <div class="mt-1">
          {% for c,p in item.top %}
          <span class="chip">{{ c }} ({{ '%.2f'|format(p) }})</span>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="empty">No history yet. Make a prediction from the dashboard.</p>
{% endif %}
{% endblock %}
{% block extra_body_end %}
<script>
  (function(){
    const els = document.querySelectorAll('.timeago');
    function fmt(t){
      const d = new Date(t);
      const s = Math.floor((Date.now() - d.getTime())/1000);
      const r = (n, u) => `${n} ${u}${n>1?'s':''} ago`;
      if (s < 60) return r(s, 'sec');
      const m = Math.floor(s/60); if (m < 60) return r(m, 'min');
      const h = Math.floor(m/60); if (h < 24) return r(h, 'hour');
      const d2 = Math.floor(h/24); if (d2 < 30) return r(d2, 'day');
      const mo = Math.floor(d2/30); if (mo < 12) return r(mo, 'month');
      const y = Math.floor(mo/12); return r(y, 'year');
    }
    function render(){ els.forEach(el => { const t = el.getAttribute('data-time'); if (t) el.textContent = fmt(t); }); }
    render(); setInterval(render, 60000);
  })();
</script>
{% endblock %}
